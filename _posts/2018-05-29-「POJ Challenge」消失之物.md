---
title: 「POJ Challenge」消失之物
date: 2018-05-29 20:38:35
categories:
- 动态规划
tags:
- 背包
- DP套DP
mathjax: true
---

> 题目大意：有 $N$ 个物品，体积分别是 $W_1,W_2,\cdots,W_N$，其中第 $i$ 个物品丢失了，使用剩下的 $N-1$ 个物品装满容积为 $x$ 的背包的方案数记为 $Count(i,x)$，输出所有 $1<=i<=N, 1<=x<=M$ 的 $Count(i,x)$ 表格。$1≤N≤2×10^3,1≤M≤2×10^3$

复杂度肯定是平方的了，普通的01背包就是平方的，考虑怎样在其中加点东西。容易发现01背包就是枚举物品往背包里放的，在这过程中就把 $<=M$ 的能装满的容量都求了一遍，关键是怎样知道哪个物品没放进去。枚举到第 $i$ 个物品时，$i$ 后面的物品肯定是都没放的，而 $i$ 前面的物品就不好处理了。

我一开始是这样想的：既然01背包的 $f[i][j]$ 是表示在放上第 $i$ 件物品时，恰好装满容量为 $j$ 的背包，那么就可以用补集的思想，改成一个一个往外拿物品，$f[i][j]$ 表示拿走第 $i$ 件物品时，恰好使容量为 $j$ 的背包满容。

初始时背包里放上所有的物品，然后一个一个往外拿，$f[i][j]$ 由状态 $f[i-1][j+w[i]]$ 转移过来，因为是求方案数，转移方程大概是：

$$f[i][j] += f[i-1][j+w[i]]$$

我在实现的时候才发现出了个大锅，01背包的 $f[i][j]$ 并不表示放上 $i$ 以后恰好装满 $j$，$j$ 有可能是没满的，因为前提是在前 $i$ 个物品中拿走一些物品。。那么在装满版的01背包的状态转移中，$f[i][j]=-∞$ 即没装满的意义是什么，想了一会我才发现它什么意义都没有，它根本不可能为后面的价值做贡献，只是用来判断满没满而已。。

那上面的做法就凉了呀。。

Gary说可以先求一遍01背包。然而我并没有想出来怎么做。。看来我只会 $O(n^2m)$ 的暴力了！！

于是我去参悟了一下题解：

![](http://images.cnblogs.com/cnblogs_com/milky-w/1226322/o_QQ%e5%9b%be%e7%89%8720180530113345.png)

去掉某个元素，相当于把它的贡献减掉，就跟网络流退流似的。。

感觉这个题非常好啊，感谢Gary的推荐。。原来这叫DP套DP。。

---

我还是想放上Gary的原话：“所以你认为这道题在你做来是什么难度，因为这道题我把它放在课件最前面了，连题解都没写。”

<center>……</center>

![](http://images.cnblogs.com/cnblogs_com/milky-w/1226322/o_QQ%e5%9b%be%e7%89%8720180530111145.jpg)
