---
title: 「ZJOI 2008」生日聚会
date: 2018-06-26 16:19:34
categories:
- 动态规划
mathjax: true
---

> 题目大意：给 $m$ 个男孩和 $n$ 个女孩排队，求任意区间男女之差不超过 $k$ 的方案数。$n,m≤150，k≤20$

先想到用差值DP，设 $f[i][j][k]$ 表示前 $i$ 个人中，男女人数差值为 $j$ 的方案数，其中 $k=0$ 表示男生多，$k=1$ 表示女生多。有：

$$f[i][j][k] = f[i-1][j-1][k] + f[i-1][j+1][k\text{^}1]$$

然后我就发现这样做的问题了，这样只保证了区间 $[0,i]$ 的差值不超过 $k$，而不满足任意一段区间。

无奈看了题解，吐槽一下网上众多题解毒害萌新，都写 “$f[i][j][a][b]$ 表示男生有 $i$ 个，女生有 $j$ 个，**任意一段区间**男生最多比女生多 $a$ 个，女生最多比男生多 $b$ 个的方案数”，然而这里并不是**任意一段区间**，而是当前状态的后缀。

比如 $♂♂♂♀♀♀♂$ 这样一段序列，最右边的 $♂$ 是新加入的，这种状态应该是 $f[4][3][1][2]$，即从最右边的 $♂$ 开始往前的一段连续区间里，男生最多比女生多 $1$ 个，女生最多比男生多 $2$ 个，也就是一段后缀。

所以有状态转移方程：

$$f[i+1][j][a+1][max(b-1,0)] += f[i][j][a][b]$$

$$f[i][j+1][max(a-1,0)][b+1] += f[i][j][a][b]$$

这种设法的妙处在于，动态从右端加入元素，每次取差值最大的后缀，相当于遍历了任意一段区间，是一道很好的DP题。

---

从昨天晚上开始问了一圈人，都没有弄明白，今早昊哥一句话就懂了，昊哥最帅！！！
