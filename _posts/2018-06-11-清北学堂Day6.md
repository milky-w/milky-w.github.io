---
title: 清北学堂Day6
date: 2018-06-11 20:58:41
categories:
- 数学
- 考试
tags:
- 
mathjax: true
---

## T2

> 题目大意：给定 $a$, $b$, $c$, $p$，输出 $a^{(b^c)}$$mod$ $p$。其中 $a, b, c, p ≤ 2*10^9$，保证 $p$ 是素数。

费马小定理。根据 $a^{(p-1)} \equiv 1(mod$ $p), a⊥p$，可将指数 $b^c$ 分解成 $b^c = k(p-1)+res$，则答案为 $a^{res} mod$ $p$。不过需要注意的是，$a$ 与 $p$ 要互质，若 $a$ 是 $p$ 的整数倍，直接输出 $0$。

------

## T3

> 题目大意：记 $f(n)$ 为 $n$ 的所有正约数的平方和，输入 $n$ 和 $P$，输出 $\sum_{i=1}^nf(i)$ 模 $P$ 的值，保证 $P$ 是素数。$n≤10^{12}, P≤10^9$

考虑每个约数对答案的贡献，有 $ans = \sum_{i=1}^n \lfloor \frac{n}{i} \rfloor i^2$，根号分治 + 二阶等差数列求和公式，时间复杂度 $O(\sqrt n)$，需要注意的是，$\frac{n(n+1)(2n+1)}{6}$ 的分子在取模的时候，要模 $6*p$。

```c++
#include <cstdio>

typedef long long ll;

ll n, p, p2, w;

ll F(ll x) {
	return (1LL) * (2 * x % p2 * x % p2 * x % p2 + 3 * x % p2 * x % p2 + x % p2) % p2 / 6;
}

int main() {
	freopen("sos.in", "r", stdin);
	freopen("sos.out", "w", stdout);
	
	scanf("%lld%lld", &n, &p);
	p2 = p * 6;
	ll l = 1, r, ans = 0, t;
	while (l <= n) {
		r = n / (n / l);
		t = (F(r) - F(l - 1) + p) % p;
		ans = (ans + (n / l) * t % p) % p;
		l = r + 1;
	}
	printf("%lld\n", ans);
	
	fclose(stdin);
	fclose(stdout);
	return 0;
}
```

考试代码，只有 $60$ 分。找了很长时间的原因，发现 $(6*10^9)^2$ 就爆了……

所以只能用下面这种方法写(std)：

```c++
#include <iostream>

using namespace std;

long long n,p,j,ans;

long long power(long long x)
{
	long long a=x,b=x+1,c=2*x+1;
	if (x & 1) b/=2; else a/=2;
	if (x % 3==0) a/=3; else if (x % 3==1) c/=3; else if (x % 3 ==2) b/=3;
	a%=p; b%=p; c%=p;
	return ((a*b) % p * c) % p;
}

int main()
{ 
	freopen("sos.in","r",stdin);
	freopen("sos.out","w",stdout);
	cin>>n>>p;
	j=0; ans=0;
	for (long long i=1;i<=n;i=j+1)
	{
		j=n/(n/i);
		ans+=((power(j)-power(i-1)+p) % p )* ( (n/i) % p );
		ans%=p;
	}
	cout<<ans<<endl; 
}
```

这题逆元是不可做的，因为不保证 $6$ 与 $p$ 互质。
