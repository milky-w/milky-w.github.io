---
title: 「WF 2011」Chips Challenge
date: 2018-05-29 11:34:27
categories:
- 网络流
tags:
- 流量等式建图
- 上下界费用流
mathjax: true
---

> 有一个芯片，芯片上有 $N×N(1≤N≤40)$ 个插槽，可以在里面装零件。有些插槽不能装零件，有些插槽必须装零件，剩下的插槽随意。要求装好之后满足如下两条要求：
> 1. 第 $i$ 行和第 $i$ 列的零件数目必须一样多 $(1≤i≤N)$。
> 2. 第 $i$ 行的零件数目不能超过总的零件数目的 $A/B$ $(1≤i≤N,0≤A≤B≤1000,B≠0)$。
> 
> 求最多可以另外放多少个零件（就是除掉必须放的）。如果无解输出 $impossible$。

如果没有 $A/B$ 这个条件，那就是最简单的二分图模型，化行列为点，在可放置的行列之间连边，再用 $A/B$ 来限制流量。

加上条件 $A/B$ 后， 我一开始是想提取出所有的边，建立点 $(i,j)$ 表示第 $i$ 行第 $j$ 列可放置零件，设 $a_i$ 表示结点 $i$ 处是否放置零件，有

$$a_{1,i}+a_{2,i}+\cdots +a_{n,i}<=A/B$$

$$a_{i,1}+a_{i,2}+\cdots +a_{i,n}<=A/B$$

即

$$a_{1,i}+a_{2,i}+\cdots +a_{n,i}+b_i=A/B$$

$$a_{i,1}+a_{i,2}+\cdots +a_{i,n}+b_i=A/B$$

差分一下，用流量等式建图，跑最大流。

下一秒我就觉得我很sb了，因为这是平衡流，流量除了等式关系之外不表示别的，所以要求最大数量应该用费用流。。。这样的话就把含 $a_i$ 的边设成费用为 $1$，跑最大费用流好了。

然后我发现我又sb了，$A/B$ 的对象是所用零件，但我们并不知道用了多少零件，所以要枚举总零件数 $tot$，然后用流量限制。

可是必须选和不能选的怎么办啊，看了题解我才惊觉要用上下界费用流。。

我的做法是把 $tot$ 的限制建在了等式里，是用单个元素的集合来表示整行整列，这样差分会出来很多重复的项，比如会有两条边都表示 $a_{1,2}$，这样的费用应该只算一次，但我没有想到什么办法可以只计算一次费用，于是这个想法就挂掉了。

（说句题外话，我在想 *志愿者招募* 那道题为什么可以用这种方法做，因为每个志愿者的工作时间是连续的，这样就保证了差分后不会出现重复元素，如果改成工作时间不连续，就不能这么做了）

而下面的做法是用整行整列来表示单个元素，即第 $i$ 行向第 $j$ 列连边表示 $(i,j)$ 的状态，这样就避免了重复元素的出现。

![](http://images.cnblogs.com/cnblogs_com/milky-w/1224598/o_QQ%e5%9b%be%e7%89%8720180529162003.png)

这是从16年国家集训队论文集里摘的，~~我亲学长写的 咳咳~~，感觉这个建图好神啊，因为题目给出行列之间的关系，所以就把行列建成点，有相等关系的就连边，再用上下界限制必须选和可以选，最巧妙的是在于，限制 $maxt$ 时由 $B_i$ 指向 $A_i$，限制 $(i,j)$ 处的放置要求时由 $A_i$ 指向 $B_j$，这样就形成了如下的流量衡等式：

$$\sum_{i=1}^n{a_{i,j}} = B_j$$

$$A_i = \sum_{j=1}^n{a_{i,j}}$$

每次跑最大费用可行流，从所有合法的方案中选取最优解。

至于为什么是 $ans>=tot$ 时方案合法，因为这个 $tot$ 是假设的，而 $ans$ 才是真正的总数，若 $x<=tot×A/B$ 且 $ans>=tot$，则有 $x<=ans×A/B$；否则必有 $x>ans×A/B$，不符合题意。

那么这题就结束了。
