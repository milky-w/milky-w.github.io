---
title: 「国家集训队」拉拉队排练
date: 2018-06-15 19:09:08
categories:
- 字符串
tags:
- Manacher
mathjax: true
---

> 题目大意：给一个字符串，求最长的 $k$ 个回文子串（此处回文子串长度必须为奇数）长度的乘积。$\|S\|≤10^6$

裸题。$Manacher$ + 快速幂。

```c++
#include <cstdio>
#include <algorithm>

typedef long long ll;
const int N = 1000010, P = 19930726;
int n, R[N], C[N]; ll k; char s[N];

ll min(ll x, ll y) {
    return x < y ? x : y;
}
ll fast_pow(ll a, ll p) {
    ll res = 1;
    for (; p; p >>= 1, a *= a) {
        if (a >= P) a %= P;
        if (p & 1) res *= a;
        if (res >= P) res %= P;
    }
    return res;
}
void manacher() {
    int mx = 0, mid = 0; R[0] = 1;
    for (int i = 1; i <= n; ++i) {
        if (i <= mx) R[i] = min(R[(mid<<1)-i], mx - i + 1);
        else R[i] = 1;
        while (s[i+R[i]] == s[i-R[i]]) ++R[i];
        if (i + R[i] - 1 > mx) mx = i + R[i] - 1, mid = i;
    }
}

int main() {
    scanf("%d%lld", &n, &k);
    scanf("%s", s + 1);
    s[0] = '$', s[n+1] = '&';
    manacher();
    for (int i = 1; i <= n; ++i) ++C[R[i]];
    for (int i = n - 1; i >= 1; --i) C[i] += C[i+1];
    ll ans = 1;
    for (int i = n; i > 1; --i) {
        if (C[i] == 0) continue;
        ans *= fast_pow((i << 1) - 1, min(k, C[i]));
        if (ans >= P) ans %= P;
        if ((k -= C[i]) <= 0) break;
    }
    printf("%lld\n", ans);
    return 0;
}
```
