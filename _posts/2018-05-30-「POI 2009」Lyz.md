---
title: 「POI 2009」Lyz
date: 2018-05-30 12:27:19
categories:
- 线段树
- 网络流
tags:
- 霍尔定理
mathjax: true
---

> 题目大意：初始时滑冰俱乐部有 $1$ 到 $n(n≤200000)$ 号的溜冰鞋各 $k$ 双。已知 $x$ 号脚的人可以穿 $x$ 到 $x+d$ 的溜冰鞋。有 $m(m≤500000)$ 次操作，每次包含两个数 $r_i,x_i$ 代表来了 $x_i$ 个 $r_i$ 号脚的人。$x_i$ 为负，则代表走了这么多人。对于每次操作，输出溜冰鞋是否足够。

这道题又是Gary推荐的，而且我又没想出正解。。咳咳咳。。

我一开始想的是，在一段连续的有流量区间内，这些流一定是可以互相交换的，所以每来一波人，找出从他们对应的鞋号开始，往下第一个没有人来过的鞋号，计算这段区间的空位和，比较一下，如果可以的话就把这波人数加到这段区间里。方法应该是没有问题的叭。

正解是用**霍尔定理**：二部图 $G$ 中的两部分顶点组成的集合分别为 $X,Y$，其中集合 $X$ 存在完美匹配的充分必要条件是：$X$ 中的任意 $k$ 个点至少与 $Y$ 中的 $k$ 个点相邻。（$1≤k≤m$）

然后我才发现我记的霍尔定理一直是霍尔定理的推论。。咳咳。。

我上面的想法很接近正解了，就是麻烦了一些，其实没必要每次只计算影响到的区间，从整体角度看，只要每个区间都满足下面这个式子就可以了：

$$\sum_{i=l}^r{a_i}≤k(r+d-l+1)$$

其中 $a_i$ 表示 $i$ 号鞋的人数。

将式子转化一下，变成：

$$\sum_{i=l}^r{(a_i-k)}≤k×d$$

这样就可以线段树每次单点加 $a_i-k$，查询最大连续子段和看是否小于等于 $k×d$。
